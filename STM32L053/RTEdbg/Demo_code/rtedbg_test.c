/*
 * Copyright (c) Branko Premzel.
 *
 * SPDX-License-Identifier: MIT
 */

/***
 * @file    rtedbg_test.c
 * @author  Branko Premzel
 *
 * @brief This is a test file for the RTEdbg library and tools. It can be used to check
 * data logging functions during porting to another compiler or another CPU core
 * Format definitions for this test file are in "Fmt/rte_test.h".
 *
 * @note Most functions are called twice with the same parameters to simplify
 *       measurement of data logging function execution times.
 */

#include "rtedbg.h"
#include "rte_test.h"

const uint32_t Test_data[] = {
    0x14131211U, 0x84838281U, 0xF4F3F2F1U, 0x04030201U,
    0x0CCC0888U, 0x9988AA0AU, 0xDDCCBBAAU, 0x0201FFEEU,
    0x34333231U, 0x38373635U, 0x3C3B3A39U, 0x403F3E3DU,
    0x44434241U, 0x48474645U, 0x4C4B4A49U, 0x504F4E4DU,
    0x54535251U, 0x58575655U, 0x5C5B5A59U, 0x605F5E5DU,
    0xA4A3A2A1U, 0xA7A7A6A5U, 0xACABAAA9U, 0xB0AFAEADU
    };

void rtedbg_test(void)
{
    uint32_t i;

    // Initialize data logging structures and enable all message filters
    // Select the desired function call (one of the following two)

#if RTE_SINGLE_SHOT_ENABLED == 0
    rte_init(RTE_ENABLE_ALL_FILTERS, RTE_RESTART_LOGGING);      // Erase the data logging buffer and restart logging
    //rte_init(RTE_ENABLE_ALL_FILTERS, RTE_CONTINUE_LOGGING);   // Keep logged data and restart just the timestamp counter
#else
    //rte_init(RTE_ENABLE_ALL_FILTERS, RTE_SINGLE_SHOT_LOGGING);
    rte_init(RTE_ENABLE_ALL_FILTERS, RTE_SINGLE_SHOT_AND_ERASE_BUFFER);
#endif
    /* Note: The rte_init() function must be called before the interrupts that trigger the logging
     * of the long timestamp are initialized. Just to simplify the example, the rte_init() call
     * for this demo is included in this file.
     */

    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST1, F_MSG1, 15U)
    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST1, F_MSG2, 15U)
    RTE_MSG0(MSG0_TEST, F_MSG3)
    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST1, F_MSG1, 1U)

    RTE_EXT_MSG1_3(EXT_MSG1_3_TEST1, F_MSG2, 1U, 6U)
    RTE_MSG1(MSG1_TEST, F_MSG2, 1U)
    RTE_MSG1(MSG1_TEST, F_MSG2, 1U)
    RTE_MSG1(MSG1_TEST, F_MSG2, 0x80000001U)
    RTE_MSG1(MSG1_TEST, F_MSG2, 0xEEDDCCAAU)

    RTE_MSG2(MSG2_TEST, F_MSG2, 1U, 2U)
    RTE_MSG2(MSG2_TEST, F_MSG2, 1U, 2U)
    RTE_MSG2(MSG2_TEST, F_MSG2, 0x80000001U, 0x80000002U)
    RTE_MSG2(MSG2_TEST, F_MSG2, 11U, 0x80000022U)
    RTE_MSG2(MSG2_TEST, F_MSG2, 0x80000011U, 0x00000022U)

    RTE_MSG3(MSG3_TEST, F_MSG2, 1U, 2U, 3U)
    RTE_MSG3(MSG3_TEST, F_MSG3, 1U, 2U, 3U)
    RTE_MSG3(MSG3_TEST, F_MSG3, 0x80000001U, 0x80000002U, 0x80000003U)
    RTE_MSG3(MSG3_TEST, F_MSG2, 0x00000001U, 0x80000003U, 0x80000004U)
    RTE_MSG3(MSG3_TEST, F_MSG3, 0x80000001U, 0x88888882U, 0x00000003U)

    RTE_MSG4(MSG4_TEST, F_MSG2, 1U, 2U, 3U, 4U)
    RTE_MSG4(MSG4_TEST, F_MSG1, 1U, 2U, 3U, 4U)
    RTE_MSG4(MSG4_TEST, F_MSG1, 0x80000001U, 0x80000002U, 0x80000003U, 0x80000004U)
    RTE_MSG4(MSG4_TEST, F_MSG1, 0x44444441U, 0x80000002U, 0x33112233U, 0x80000004U)
    RTE_MSG4(MSG4_TEST, F_MSG1, 0x87654321U, 0x76543210U, 0xF3219876U, 0x55443322U)

    RTE_MSGN(MSGN_TEST, F_MSG1, &Test_data[0U], 7U)
    RTE_MSGN(MSGN_TEST, F_MSG2, &Test_data[1U], 16U)
    RTE_MSGN(MSGN_TEST, F_MSG2, &Test_data[0U], 64U)
    RTE_MSGN(MSGN_TEST, F_MSG2, &Test_data[3U], 15U)
    RTE_MSGN(MSGN_TEST, F_MSG2, &Test_data[4U], 20U)
    RTE_MSGN(MSGN_TEST, F_MSG2, &Test_data[5U], 24U)

    RTE_MSG0(MSG0_TEST, F_MSG3)
    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST1, F_MSG1, 15U)
    RTE_MSG1(MSG1_TEST, F_MSG1, 0x1234U)
    RTE_EXT_MSG1_3(EXT_MSG1_3_TEST1, F_MSG1, 0x1234U, 7U)
    RTE_MSG2(MSG2_TEST, F_MSG1, 0xD2344321U, 0x12345678U)
    RTE_EXT_MSG2_2(EXT_MSG2_2_TEST1, F_MSG1, 0xD2344321U, 0x12345678U, 3U)
    RTE_MSG3(MSG3_TEST, F_MSG1, 1U, 2U, 3U)
    RTE_EXT_MSG3_1(EXT_MSG3_1_TEST1, F_MSG1, 1U, 2U, 3U, 1U)
    RTE_MSG4(MSG4_TEST, F_MSG1, 1U, 2U, 3U, 1U)

//    const char * Test_string = (const char *)&Test_data;
    const char Test_string[] __attribute__((aligned(4))) =
            "\x01\x02\x03\x04\x05\x06\x07\x08\x09\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x20"
            "\x21\x22\x23\x24\x25\x26\x27\x28\x29\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x40"
            "\x41\x42\x43\x44\x45\x46\x47\x48\x49\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x60"
            "\x61\x62\x63\x64\x65\x66\x67\x68\x69\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x80";
    RTE_STRING(MSGN_TEST, F_MSG2, Test_string)
    RTE_STRINGN(MSGN_TEST, F_MSG2, &Test_string[4U], 8U)

    RTE_MSG3(MSG3_TEST, F_MSG1, 49U, 48U, 41U)
    RTE_MSG3(MSG3_TEST, F_MSG2, 0xFFFFFFFFU, 0x80018001U, 0x81818181U)
    RTE_MSG0(MSG0_TEST, F_MSG2)
    RTE_MSG2(MSG2_TEST, F_MSG2, 0x12377U, 9U)
    RTE_MSG1(MSG1_TEST, F_MSG2, 0x1234U)
    RTE_MSG2(MSG2_TEST, F_MSG2, 0xD2344321U, 0x12345678U)

    for (i = 0U; i < 33U; i++)
    {
        RTE_MSGN(MSGN_TEST, F_MSG3, &Test_data[i & 7U], i)
    }

    for (i = 0U; i < 40U; i++)
    {
        RTE_MSGX(MSGX_TEST, F_MSG3, &Test_string[i], i)
    }

    rte_long_timestamp();
    rte_long_timestamp();    // Called twice to measure the logging function execution time

#if 0
    // RTE_FMT_ID_BITS must be set to 12 or more enable test of all RTE_EXT_MSG macros and the
    //   INCLUDE("rte_test_ext_msg.h")"
    // directive must be added to the "rte_main_fmt.h" format definition file
#include "rte_test_ext_msg.h"
    RTE_EXT_MSG0_1(EXT_MSG0_1_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_1(EXT_MSG0_1_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_1(EXT_MSG0_1_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_2(EXT_MSG0_2_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_2(EXT_MSG0_2_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_2(EXT_MSG0_2_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_3(EXT_MSG0_3_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_3(EXT_MSG0_3_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_3(EXT_MSG0_3_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_4(EXT_MSG0_4_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_5(EXT_MSG0_5_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_5(EXT_MSG0_5_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_5(EXT_MSG0_5_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_6(EXT_MSG0_6_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_6(EXT_MSG0_6_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_6(EXT_MSG0_6_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_7(EXT_MSG0_7_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_7(EXT_MSG0_7_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_7(EXT_MSG0_7_TEST, F_MSG1, 0xFFFFFFFFU)

    RTE_EXT_MSG0_8(EXT_MSG0_8_TEST, F_MSG1, 0U)
    RTE_EXT_MSG0_8(EXT_MSG0_8_TEST, F_MSG1, 1U)
    RTE_EXT_MSG0_8(EXT_MSG0_8_TEST, F_MSG1, 0xFFFFFFFFU)

    //- - - - - - - - - - - - - - - - - - - - - - -
    RTE_EXT_MSG1_1(EXT_MSG1_1_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_1(EXT_MSG1_1_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_1(EXT_MSG1_1_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_2(EXT_MSG1_2_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_2(EXT_MSG1_2_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_2(EXT_MSG1_2_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_3(EXT_MSG1_3_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_3(EXT_MSG1_3_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_3(EXT_MSG1_3_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_4(EXT_MSG1_4_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_4(EXT_MSG1_4_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_4(EXT_MSG1_4_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_5(EXT_MSG1_5_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_5(EXT_MSG1_5_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_5(EXT_MSG1_5_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_6(EXT_MSG1_6_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_6(EXT_MSG1_6_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_6(EXT_MSG1_6_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    RTE_EXT_MSG1_7(EXT_MSG1_7_TEST, F_MSG2, 0x11U, 0U)
    RTE_EXT_MSG1_7(EXT_MSG1_7_TEST, F_MSG2, 0x11U, 1U)
    RTE_EXT_MSG1_7(EXT_MSG1_7_TEST, F_MSG2, 0x11U, 0xFFFFFFFFU)

    //- - - - - - - - - - - - - - - - - - - - - - -
    RTE_EXT_MSG2_1(EXT_MSG2_1_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_1(EXT_MSG2_1_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_1(EXT_MSG2_1_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    RTE_EXT_MSG2_2(EXT_MSG2_2_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_2(EXT_MSG2_2_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_2(EXT_MSG2_2_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    RTE_EXT_MSG2_3(EXT_MSG2_3_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_3(EXT_MSG2_3_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_3(EXT_MSG2_3_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    RTE_EXT_MSG2_4(EXT_MSG2_4_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_4(EXT_MSG2_4_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_4(EXT_MSG2_4_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    RTE_EXT_MSG2_5(EXT_MSG2_5_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_5(EXT_MSG2_5_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_5(EXT_MSG2_5_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    RTE_EXT_MSG2_6(EXT_MSG2_6_TEST, F_MSG1, 0x11U, 0x22U, 0U)
    RTE_EXT_MSG2_6(EXT_MSG2_6_TEST, F_MSG1, 0x11U, 0x22U, 1U)
    RTE_EXT_MSG2_6(EXT_MSG2_6_TEST, F_MSG1, 0x11U, 0x22U, 0xFFFFFFFFU)

    //- - - - - - - - - - - - - - - - - - - - - - -
    RTE_EXT_MSG3_1(EXT_MSG3_1_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0U)
    RTE_EXT_MSG3_1(EXT_MSG3_1_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 1U)
    RTE_EXT_MSG3_1(EXT_MSG3_1_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0xFFFFFFFFU)

    RTE_EXT_MSG3_2(EXT_MSG3_2_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0U)
    RTE_EXT_MSG3_2(EXT_MSG3_2_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 1U)
    RTE_EXT_MSG3_2(EXT_MSG3_2_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0xFFFFFFFFU)

    RTE_EXT_MSG3_3(EXT_MSG3_3_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0U)
    RTE_EXT_MSG3_3(EXT_MSG3_3_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 1U)
    RTE_EXT_MSG3_3(EXT_MSG3_3_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0xFFFFFFFFU)

    RTE_EXT_MSG3_4(EXT_MSG3_4_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0U)
    RTE_EXT_MSG3_4(EXT_MSG3_4_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 1U)
    RTE_EXT_MSG3_4(EXT_MSG3_4_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0xFFFFFFFFU)

    RTE_EXT_MSG3_5(EXT_MSG3_5_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0U)
    RTE_EXT_MSG3_5(EXT_MSG3_5_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 1U)
    RTE_EXT_MSG3_5(EXT_MSG3_5_TEST, F_MSG2, 0x11U, 0x22U, 0x33U, 0xFFFFFFFFU)

    //- - - - - - - - - - - - - - - - - - - - - - -
    RTE_EXT_MSG4_1(EXT_MSG4_1_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0U)
    RTE_EXT_MSG4_1(EXT_MSG4_1_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 1U)
    RTE_EXT_MSG4_1(EXT_MSG4_1_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0xFFFFFFFFU)

    RTE_EXT_MSG4_2(EXT_MSG4_2_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0U)
    RTE_EXT_MSG4_2(EXT_MSG4_2_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 1U)
    RTE_EXT_MSG4_2(EXT_MSG4_2_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0xFFFFFFFFU)

    RTE_EXT_MSG4_3(EXT_MSG4_3_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0U)
    RTE_EXT_MSG4_3(EXT_MSG4_3_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 1U)
    RTE_EXT_MSG4_3(EXT_MSG4_3_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0xFFFFFFFFU)

    RTE_EXT_MSG4_4(EXT_MSG4_4_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0U)
    RTE_EXT_MSG4_4(EXT_MSG4_4_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 1U)
    RTE_EXT_MSG4_4(EXT_MSG4_4_TEST, F_MSG1, 0x11U, 0x22U, 0x33U, 0x44U, 0xFFFFFFFFU)
#endif
}

/*==== End of file ====*/
